<app-base [submenus]="submenus"></app-base>
<main>
  <div class="row">
    <div class="col m1"></div>
    <div class="col s12 m10">
      <div class="card hoverable">
        <div class="card-content">
          <div class="blue lighten-1 white-text">
            <span class="card-title center">Print invoice</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="invoice">
    <div class="col s12 m12 center">
      <button class="btn-small blue" (click)="generatePdf()">
        <i class="material-icons">print</i>Print invoice
      </button>
    </div>
    <div class="col m1"></div>
    <div class="col s12 m10">
      <div class="card hoverable invoice-container" #poDiv id="purchaseOrder">
        <div class="card-content">
          <div class="row grey lighten-1 header-po">
            <div class="col s4 m4">
              <img
                src="../../../../assets/images/almapps-logo.png"
                style="height: 40px"
                alt=""
              />
            </div>
            <div class="col s8 m8 right-align"><h5>INVOICE</h5></div>
          </div>
          <div class="row" style="font-size: 13px">
            <div class="col s5 m5">
              <p>{{ invoice.company.name }}</p>
              <p>{{ invoice.company.address }}</p>
              <p>{{ invoice.company.po_box }}</p>
              <p>{{ invoice.company.phone1 }}</p>
              <p>{{ invoice.company.contact_name }}</p>
              <p>{{ invoice.company.contact_email1 }}</p>
            </div>
            <div class="col s2 m2"></div>
            <div class="col s5 m5 right-align">
              <p>
                <b>Date: {{ invoice.date_op | date: "dd-MM-YYYY" }}</b>
              </p>
              <p>
                <b>Reference: {{ invoice.reference }}</b>
              </p>
              <qrcode
                *ngIf="showQr"
                [qrdata]="invoice.reference"
                [width]="70"
              ></qrcode>
            </div>
          </div>
          <div class="row" style="font-size: 13px !important">
            <div class="col s5 m5">
              <h6
                class="center blue darken-2 white-text"
                style="padding: 8px 0 8px 0px"
              >
                Bill To
              </h6>
              <p>{{ invoice.client.name }}</p>
              <p>{{ invoice.client.email }}</p>
              <p>{{ invoice.client.address }}</p>
              <p>{{ invoice.client.phone }}</p>
            </div>
            <div class="col s2 m2"></div>
            <div class="col s5 m5">
              <h6
                class="center blue darken-2 white-text"
                style="padding: 8px 0 8px 0px"
              >
                Address
              </h6>
              <p>{{ invoice.company.name }}</p>
              <p>{{ invoice.company.address }}</p>
              <p>{{ invoice.company.po_box }}</p>
              <p>{{ invoice.company.contact_name }}</p>
              <p>
                {{ invoice.company.contact_phone1 }} /
                {{ invoice.company.contact_phone2 }}
              </p>
              <p>{{ invoice.company.contact_email1 }}</p>
              <p>{{ invoice.company.contact_email2 }}</p>
            </div>
          </div>
          <div
            class="row"
            *ngIf="invoice.has_heading"
            style="background-color: gainsboro"
          >
            <p class="center">{{ invoice.heading }}</p>
          </div>
          <div class="row">
            <table *ngIf="invoice.jobs.length != 0">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Job</th>
                  <th>Duration</th>
                  <th>Unit Price</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of invoice.jobs; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ item.job.job_name }}</td>
                  <td>
                    <p class="right-align">{{ item.job.duration }}</p>
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        item.job.price | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        calculateTotalAmountJobs(item)
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3"></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3"><b>Total without VAT</b></td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateTotalWithouxVAT()
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr *ngIf="invoice.tva_status">
                  <td></td>
                  <td colspan="3">
                    <b>VAT ( 19.25% )</b>
                  </td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateVATAmount()
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3">
                    <b>Total</b>
                  </td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateTotal() | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
            <table *ngIf="invoice.products.length != 0">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of invoice.products; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ item.product.name }}</td>
                  <td>
                    <p class="right-align">{{ item.quantity }}</p>
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        item.unit_price | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        calculateTotalAmountJobs(item)
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3"></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3"><b>Total without VAT</b></td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateTotalWithouxVAT()
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr *ngIf="invoice.tva_status">
                  <td></td>
                  <td colspan="3">
                    <b>VAT ( 19.25% )</b>
                  </td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateVATAmount()
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td></td>
                  <td colspan="3">
                    <b>Total</b>
                  </td>
                  <td>
                    <p class="right-align" style="font-weight: bolder">
                      {{
                        calculateTotal() | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
            <table *ngIf="invoice.technicians.length != 0">
              <tbody>
                <tr>
                  <td style="width: 5%">SN</td>
                  <td style="width: 30%">Name</td>
                  <td style="width: 25%">Description</td>
                  <td colspan="3" style="width: 10%">Hours</td>
                  <td colspan="2" style="width: 30%"></td>
                </tr>

                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>TS1</td>
                  <td>TS2</td>
                  <td>TOTAL</td>
                  <td>UNIT PRICE</td>
                  <td>AMOUNT</td>
                </tr>
              </tbody>

              <tbody *ngFor="let item of invoice.technicians; index as i">
                <tr>
                  <td rowspan="6">{{ i + 1 }}</td>
                  <td rowspan="6">{{ item.technician.name }}</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td class="center"></td>
                  <td class="center"></td>
                </tr>
                <tr>
                  <td>Normal hours</td>
                  <td>{{ item.normal_hour1 }}</td>
                  <td>{{ item.normal_hour2 }}</td>
                  <td>{{ item.normal_hour1 + item.normal_hour1 }}</td>
                  <td>
                    {{
                      item.normal_unit_price
                        | customCurrency: invoice.currency_used
                    }}
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        item.normal_unit_price *
                          (item.normal_hour1 + item.normal_hour2)
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>Overtime</td>
                  <td>{{ item.overtime_hour1 }}</td>
                  <td>{{ item.overtime_hour2 }}</td>
                  <td>{{ item.overtime_hour1 + item.overtime_hour2 }}</td>
                  <td>
                    {{
                      item.overtime_unit_price
                        | customCurrency: invoice.currency_used
                    }}
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        item.overtime_unit_price *
                          (item.overtime_hour1 + item.overtime_hour2)
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>Daily allowance</td>
                  <td>{{ item.allowance_hour1 }}</td>
                  <td>{{ item.allowance_hour2 }}</td>
                  <td>{{ item.allowance_hour1 + item.allowance_hour2 }}</td>
                  <td>
                    {{
                      item.allowance_unit_price
                        | customCurrency: invoice.currency_used
                    }}
                  </td>
                  <td>
                    <p class="right-align">
                      {{
                        item.allowance_unit_price *
                          (item.allowance_hour1 + item.allowance_hour2)
                          | customCurrency: invoice.currency_used
                      }}
                    </p>
                  </td>
                </tr>
              </tbody>

              <tr>
                <td></td>
                <td colspan="6">TOTAL HORS TAXE</td>
                <td>
                  <p class="right-align">
                    {{
                      calculateTotalWithouxVAT()
                        | customCurrency: invoice.currency_used
                    }}
                  </p>
                </td>
              </tr>
              <tr *ngIf="invoice.tva_status">
                <td></td>
                <td colspan="6">VAT (19,25%)</td>
                <td>
                  <p class="right-align">
                    {{
                      calculateVATAmount()
                        | customCurrency: invoice.currency_used
                    }}
                  </p>
                </td>
              </tr>
              <tr class="grey lighten-3">
                <td></td>
                <td colspan="6"><b>GRAND TOTAL</b></td>
                <td>
                  <p class="right-align">
                    <b>{{
                      calculateTotal() | customCurrency: invoice.currency_used
                    }}</b>
                  </p>
                </td>
              </tr>
            </table>
          </div>
          <div class="row">
            <p>
              Amount in leters:
              <b
                >{{ calculateTotal() | currencyToWord }}
                {{ invoice.currency_used }}</b
              >
            </p>
          </div>
          <div class="row">
            <div class="col s12 m6">
              <p>Yours sincerely</p>
              <p>{{ invoice.user.username }}</p>
            </div>
          </div>
          <div
            class="center footer"
            style="font-size: 12px; font-style: italic"
          >
            <b>
              <i
                >{{ invoice.company.rc }} | {{ invoice.company.po_box }} |
                {{ invoice.company.phone }} | {{ invoice.company.email }}</i
              ><br />
              <i
                >{{ invoice.company.nui }} | {{ invoice.company.bank_name }} |
                {{ invoice.company.bank_iban }} | www.almapps.com</i
              >
            </b>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

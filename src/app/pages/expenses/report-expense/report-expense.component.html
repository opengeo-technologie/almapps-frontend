<app-base [submenus]="submenus"></app-base>
<main style="padding-left: 320px; padding-top: 30px">
  <div class="row">
    <!-- <div class="col m1"></div> -->
    <div class="col s12 m12">
      <div class="card hoverable">
        <div class="card-content">
          <div class="blue lighten-1 white-text">
            <span class="card-title center">Edit expenses reports</span>
          </div>
          <hr />
          <div class="row center">
            <h6>Select period</h6>
            <hr />
            <div class="col s12 m4">
              <p>
                <label>
                  <input
                    class="with-gap"
                    name="group1"
                    (change)="onSelectionChange($event)"
                    type="radio"
                    value="year"
                  />
                  <span>Yearly</span>
                </label>
              </p>
            </div>
            <div class="col s12 m4">
              <p>
                <label>
                  <input
                    class="with-gap"
                    name="group1"
                    (change)="onSelectionChange($event)"
                    type="radio"
                    value="month"
                    checked
                  />
                  <span>Monthly</span>
                </label>
              </p>
            </div>
            <div class="col s12 m4">
              <p>
                <label>
                  <input
                    class="with-gap"
                    name="group1"
                    (change)="onSelectionChange($event)"
                    type="radio"
                    value="week"
                  />
                  <span>Weekly</span>
                </label>
              </p>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col s12 m4">
              <div class="form-input">
                <label>Year</label>
                <div class="input-field">
                  <select
                    #selectYear
                    [(ngModel)]="selectedYear"
                    (change)="onYearOrMonthChange()"
                  >
                    <option *ngFor="let year of years" [value]="year">
                      {{ year }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col s12 m4" *ngIf="isMonthActive || isWeekActive">
              <div class="form-input">
                <label>Month</label>
                <div class="input-field">
                  <select
                    #selectMonth
                    [(ngModel)]="selectedMonth"
                    (change)="onYearOrMonthChange()"
                  >
                    <option *ngFor="let month of months" [value]="month.value">
                      {{ month.name }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col s12 m4" *ngIf="isWeekActive">
              <div class="form-input">
                <label>Week</label>
                <div class="input-field">
                  <select #selectWeek [(ngModel)]="selectedWeek">
                    <option value="null" selected disabled>Choose week</option>
                    <ng-container *ngFor="let group of groupedWeeks">
                      <optgroup [label]="group.month">
                        <option
                          *ngFor="let week of group.weeks"
                          value="{{ week | json }}"
                        >
                          {{ week.label }}
                        </option>
                      </optgroup>
                    </ng-container>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col s12 m12 center">
              <a class="btn indigo darken-4 my-button" (click)="onSubmit()"
                ><i class="material-icons">insert_drive_file</i>Extract
                report</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="expenses.length != 0">
    <div class="col s12 m12 center">
      <button class="btn-small blue my-button" (click)="generatePdf()">
        <i class="material-icons">print</i>Print
      </button>
    </div>
    <div class="col m1"></div>
    <div class="col s12 m10">
      <div
        class="card hoverable"
        style="border: 2px solid black"
        #poDiv
        id="purchaseOrder"
      >
        <div class="card-content">
          <div class="row grey lighten-1 header-po">
            <div class="col s4 m4">
              <img
                src="../../../../assets/images/almapps-logo.png"
                style="height: 40px"
                alt=""
              />
            </div>
            <div class="col s8 m8 right-align">
              <h5>Expense report</h5>
            </div>
          </div>
          <div class="row" style="font-size: 13px">
            <div class="col s12 m12 center">
              <h6
                class="center grey darken-2 white-text"
                style="padding: 3px 0 3px 0px"
              >
                {{ reportTitle() }}
              </h6>
            </div>
          </div>
          <hr />
          <div class="row">
            <table>
              <thead>
                <tr>
                  <th>Expence reference</th>
                  <th>Expence label</th>
                  <th>Date</th>
                  <th><span class="right">Amount</span></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of expenses">
                  <td>{{ item.reference }}</td>
                  <td>{{ item.label }}</td>
                  <td>{{ item.date | date : "dd-MM-YYYY" }}</td>
                  <td>
                    <p class="right-align">
                      {{ item.amount | customCurrency }}
                    </p>
                  </td>
                </tr>
                <tr>
                  <td colspan="3"><b class="left-align">Total</b></td>
                  <td>
                    <p
                      class="right-align green white-text"
                      style="font-weight: bolder"
                    >
                      {{ calculateTotalExpense() | customCurrency }}
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
            <br />
            <p>
              <u>Amount in letters:</u>
              <b>{{ calculateTotalExpense() | currencyToWord }} FCFA</b>
            </p>
          </div>
          <br />
          <i style="font-size: 12px">Edited by: {{ user.username }}</i>
        </div>
      </div>
    </div>
  </div>
  <div class="row" *ngIf="expenses.length == 0">
    <div class="card">
      <div class="card-content center">
        <p class="red-text">No report available for the period selected.</p>
      </div>
    </div>
  </div>
</main>
